<div id="config-panel" class="space-y-4">
  <div class="flex items-center justify-between text-xs text-gray-500 mb-1">
    <p class="font-semibold text-gray-700">Active config: {{ config_source }}</p>
    <p class="text-xs text-gray-400">Edit the YAML to override settings for the entire demo.</p>
  </div>
  {% if config_message %}
  <div
    class="rounded-2xl border px-4 py-2 text-sm {{ 'border-green-300 bg-green-50 text-green-800' if message_type == 'success' else 'border-red-300 bg-red-50 text-red-800' if message_type == 'error' else 'border-gray-200 bg-gray-50 text-gray-700' }}"
  >
    {{ config_message }}
  </div>
  {% endif %}
  {% if config_message %}
  <script>
    window.dispatchEvent(
      new CustomEvent("ragdoll:toast", {
        detail: {
          message: {{ config_message | tojson }},
          type: "{{ message_type or 'success' }}",
        },
      })
    );
  </script>
  {% endif %}
  <form
    hx-post="/config"
    hx-target="#config-panel"
    hx-swap="outerHTML"
    hx-indicator="#config-indicator"
    class="space-y-4"
  >
    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-2">Editable YAML (defaults shown below)</label>
      <textarea
        name="config_yaml"
        rows="18"
        class="w-full rounded-2xl border border-gray-300 bg-white p-3 text-xs font-mono text-gray-700 leading-relaxed focus:border-ragdoll-green focus:ring-ragdoll-green"
      >{{ config_yaml | e }}</textarea>
    </div>
    <div class="flex items-center justify-between gap-4">
      <span id="config-indicator" class="htmx-indicator text-xs text-gray-500">Applying configurationâ€¦</span>
      <button
        type="submit"
        class="px-4 py-2 rounded-2xl bg-ragdoll-green text-white text-sm font-semibold shadow hover:bg-ragdoll-green/90 transition"
      >
        Save & Apply Config (creates shared AppConfig)
      </button>
    </div>
  </form>
  <p class="text-xs text-gray-500">
    The YAML above is the same default configuration shipped with RAGdoll. Save your edits to create a
    new AppConfig that all ingestion, graph, and LLM components will use for this demo session.
  </p>
</div>
